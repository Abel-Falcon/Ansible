---
# üß© Playbook maestro para Ubuntu Server
# Configura seguridad, usuarios, firewall y mantenimiento b√°sico

- name: "Despliegue completo - Ubuntu Server"
  hosts: ubuntu_servers
  become: yes
  gather_facts: yes

  vars:
    timezone: "America/Lima"
    selinux_state: "disabled"
    firewall_masquerade: false

  roles:
    # 1Ô∏è‚É£ Configuraci√≥n b√°sica y actualizaci√≥n del sistema
    - role: common
      tags: ["base", "update"]

    # 2Ô∏è‚É£ Configuraci√≥n de usuarios y permisos
    - role: usuarios_ubuntu
      tags: ["usuarios"]

    # 3Ô∏è‚É£ Configuraci√≥n de firewall y seguridad
    - role: firewall
      tags: ["seguridad", "firewall"]

    # 4Ô∏è‚É£ Configuraci√≥n de tareas automatizadas (cron)
    - role: mantenimiento
      tags: ["mantenimiento"]

    # 5Ô∏è‚É£ Respaldo y restauraci√≥n (si usas rear o backup)
    - role: backup
      tags: ["backup"]

  tasks:
    - name: "üì¶ Verificar estado general del sistema"
      shell: |
        echo "==================================="
        echo "   ‚úÖ Ubuntu configurado con √©xito  "
        echo "==================================="
        lsb_release -a
      register: system_info
      changed_when: false

    - name: "Mostrar informaci√≥n del sistema"
      debug:
        msg: "{{ system_info.stdout_lines }}"