# Configuración fail2ban para Proyecto SO - Ubuntu Server
# Generado automáticamente por Ansible

[DEFAULT]
# Configuración global
bantime = {{ fail2ban_bantime | default(3600) }}
findtime = {{ fail2ban_findtime | default(600) }}
maxretry = {{ fail2ban_maxretry | default(3) }}
backend = {{ fail2ban_backend | default('systemd') }}
usedns = warn
logencoding = auto
enabled = false
mode = normal

# Configuración de notificaciones
destemail = root@{{ network_domain | default('localhost') }}
sendername = Fail2Ban-ProyectoSO
mta = sendmail

# Acciones por defecto
banaction = ufw
banaction_allports = ufw
action_ = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s"]
action_mw = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s"]
            %(mta)s-whois[name=%(__name__)s, sender="%(sendername)s", dest="%(destemail)s"]
action_mwl = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s"]
             %(mta)s-whois-lines[name=%(__name__)s, sender="%(sendername)s", dest="%(destemail)s", logpath="%(logpath)s"]
action = %(action_)s


# =============================
# Protección de servicios clave
# =============================

# Protección SSH
[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
backend = systemd
maxretry = 3
bantime = 1800

# Protección HTTP (Apache2)
[apache-auth]
enabled = true
port = http,https
logpath = /var/log/apache2/error.log
maxretry = 5
bantime = 3600

[apache-badbots]
enabled = true
port = http,https
logpath = /var/log/apache2/access.log
bantime = 86400
maxretry = 1

[apache-noscript]
enabled = true
port = http,https
logpath = /var/log/apache2/access.log
maxretry = 6
bantime = 86400

[apache-overflows]
enabled = true
port = http,https
logpath = /var/log/apache2/error.log
maxretry = 2
bantime = 86400

# Protección FTP
[vsftpd]
enabled = true
port = ftp,ftp-data,ftps,ftps-data
logpath = /var/log/vsftpd.log
maxretry = 3
bantime = 3600

# Protección DNS (Bind9)
[named-refused]
enabled = true
port = domain,953
logpath = /var/log/syslog
filter = named-refused
maxretry = 5
bantime = 86400

# Protección general del sistema
[systemd-ssh]
enabled = true
journalmatch = _SYSTEMD_UNIT=ssh.service
backend = systemd
maxretry = 3
bantime = 3600

# Protección contra ataques de fuerza bruta
[recidive]
enabled = true
logpath = /var/log/fail2ban.log
banaction = %(banaction_allports)s
bantime = 604800
findtime = 86400
maxretry = 5

# Filtro personalizado para el proyecto SO
[proyecto-so-custom]
enabled = true
port = http,https,ftp,ssh
logpath = /var/log/syslog
filter = proyecto-so-custom
maxretry = 10
bantime = 7200
findtime = 3600
